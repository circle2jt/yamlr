vars:
  key: ""
  address: ""
  script: ""
runs:
  - exec'js: |
      $vars.sshCommand = ["ssh"]
      if ($vars.key) {
        $vars.sshCommand.push("-i", $vars.key)
      }
      $vars.sshCommand.push("-oStrictHostKeyChecking=no", $vars.address, "-T")
      $vars.sshCommand = $vars.sshCommand.join(' ')
      this.logger.debug('>_ ' + $vars.sshCommand)
      this.logger.debug($vars.script)

  - exec'sh: |
      ${$vars.sshCommand} <<'ENDSSH'
        ${$vars.script}
      ENDSSH
    vars: result

  - scene'returns: ${$vars.result}
